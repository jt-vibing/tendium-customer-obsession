<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture — Customer Graph</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #FFFFFF;
      --bg-elevated: #F7F8F8;
      --bg-surface: #ECEEF0;
      --text-primary: #171717;
      --text-secondary: #6B6B76;
      --text-tertiary: #A1A1A6;
      --border: rgba(0,0,0,0.08);
      --border-strong: rgba(0,0,0,0.12);
      --accent: #5E6AD2;
      --accent-subtle: rgba(94,106,210,0.10);
      --success: #16A34A;
      --purple: #7C3AED;
      --radius: 6px;
      --radius-lg: 10px;
      --shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    [data-theme="dark"] {
      --bg: #0A0A0B;
      --bg-elevated: #111114;
      --bg-surface: #18181C;
      --text-primary: #EDEDEF;
      --text-secondary: #8B8B96;
      --text-tertiary: #5C5C66;
      --border: rgba(255,255,255,0.06);
      --border-strong: rgba(255,255,255,0.10);
      --accent: #7B83EB;
      --accent-subtle: rgba(123,131,235,0.12);
      --success: #4ADE80;
      --purple: #A78BFA;
      --shadow: 0 1px 3px rgba(0,0,0,0.3);
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 48px 32px 80px;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-header h1 {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    .page-header p {
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 720px;
    }

    /* Version Selector */
    .version-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
      padding: 6px;
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      width: fit-content;
    }

    .version-btn {
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 120ms ease;
    }

    .version-btn:hover {
      background: var(--bg-surface);
      color: var(--text-primary);
    }

    .version-btn.active {
      background: var(--accent);
      color: white;
      font-weight: 600;
    }

    /* Version Content */
    .version-content {
      display: none;
    }

    .version-content.active {
      display: block;
    }

    .diagram-box {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 32px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      line-height: 1.7;
      overflow-x: auto;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .diagram-box pre {
      margin: 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
    }

    .stat-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-tertiary);
      margin-bottom: 6px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-desc {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .layer-list {
      list-style: none;
      display: grid;
      gap: 12px;
      margin-bottom: 24px;
    }

    .layer-list li {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .layer-list li strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .highlight-box {
      background: linear-gradient(135deg, var(--accent-subtle), rgba(124,58,237,0.08));
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 20px 24px;
      margin-bottom: 24px;
    }

    .highlight-box h3 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .highlight-box p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="page-header">
      <h1>Architecture</h1>
      <p>System design across 4 versions — from dashboard to MCP-first intelligence.</p>
    </div>

    <div class="version-selector">
      <button class="version-btn" data-version="v1">V1 App</button>
      <button class="version-btn" data-version="v2">V2 Agent</button>
      <button class="version-btn active" data-version="v3">V3 MCP</button>
      <button class="version-btn" data-version="v4">V4 OS</button>
    </div>

    <!-- V1: Customer Graph App -->
    <div class="version-content" data-version-content="v1">
      <div class="highlight-box">
        <h3>V1: Customer Graph App (Deferred)</h3>
        <p>Traditional Next.js dashboard with search, tabbed profiles, and pre-built views. The right idea (unified truth) but wrong interface (dashboards answer predicted questions, not unpredicted ones).</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Stack</div>
          <div class="stat-value" style="font-size: 16px;">Next.js</div>
          <div class="stat-desc">React 19 + Tailwind 4</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">UI Pattern</div>
          <div class="stat-value" style="font-size: 16px;">Tabs</div>
          <div class="stat-desc">Search + Profile Views</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Status</div>
          <div class="stat-value" style="font-size: 16px;">Deferred</div>
          <div class="stat-desc">Spec only</div>
        </div>
      </div>

      <h2 class="section-title">Architecture</h2>
      <div class="diagram-box">
        <pre>
┌─────────────────────────────────────────────────────┐
│  Browser (Next.js SSR)                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐    │
│  │  Search    │  │  Profile   │  │  Filters   │    │
│  │  Page      │  │  Tabs      │  │  Sidebar   │    │
│  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘    │
│        └────────────────┼────────────────┘           │
│                         ▼                            │
│  ┌──────────────────────────────────────────────┐   │
│  │  Next.js API Routes (/api/customers, etc.)   │   │
│  └─────────────────────┬────────────────────────┘   │
└────────────────────────┼─────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────┐
│  Supabase (Postgres)                                 │
│  - customers, subscriptions, usage, meetings         │
│  - Pre-aggregated views for dashboard cards          │
└─────────────────────────────────────────────────────┘
        </pre>
      </div>

      <h2 class="section-title">Key Layers</h2>
      <ul class="layer-list">
        <li><strong>Frontend:</strong> Next.js 16 with React 19, Tailwind 4. SSR for fast initial load.</li>
        <li><strong>API:</strong> Next.js API routes. REST endpoints for search, profile, filters.</li>
        <li><strong>Database:</strong> Supabase Postgres with pre-aggregated views (monthly_usage, health_scores, etc.).</li>
        <li><strong>Search:</strong> Client-side keyword filter. No AI/NL queries.</li>
      </ul>

      <h2 class="section-title">Why Deferred</h2>
      <div class="highlight-box" style="background: rgba(217,119,6,0.08);">
        <h3>Limitation</h3>
        <p><strong>Dashboards answer questions you predicted.</strong> V1 could show "customers by plan tier" or "renewals this quarter" — but can't answer "which customers in Sweden on Light plan have <5 logins and renew in 60 days?" You'd need to pre-build every filter combination.</p>
      </div>
    </div>

    <!-- V2: Customer Agent -->
    <div class="version-content" data-version-content="v2">
      <div class="highlight-box">
        <h3>V2: Customer Agent (Archived)</h3>
        <p>AI-first chat interface with 21 tools, rich visual cards, and HITL actions. Proved Claude can reason across 7 sources — but 60% of code was rebuilding what Claude.ai already provides.</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Code</div>
          <div class="stat-value">4,150</div>
          <div class="stat-desc">lines</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">UI Code</div>
          <div class="stat-value">60%</div>
          <div class="stat-desc">2,484 lines (chat + cards)</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tools</div>
          <div class="stat-value">21</div>
          <div class="stat-desc">11 data + 5 agg + 5 action</div>
        </div>
      </div>

      <h2 class="section-title">Architecture</h2>
      <div class="diagram-box">
        <pre>
┌─────────────────────────────────────────────────────┐
│  Browser (Next.js)                                   │
│  ┌────────────────────────────────────────────┐     │
│  │  Chat Interface (2,484 LOC)                │     │
│  │  - Message history + streaming             │     │
│  │  - Rich visual cards (6 types)             │     │
│  │  - HITL action buttons                     │     │
│  │  - Dark mode UI                            │     │
│  └──────────────────┬─────────────────────────┘     │
└────────────────────┼──────────────────────────────────┘
                     ▼
┌─────────────────────────────────────────────────────┐
│  Next.js API Route: /api/chat                        │
│  ┌────────────────────────────────────────────┐     │
│  │  Claude Sonnet 4.5 (Anthropic SDK)         │     │
│  │  - Streaming response                      │     │
│  │  - Tool orchestration                      │     │
│  └──────────────────┬─────────────────────────┘     │
└────────────────────┼──────────────────────────────────┘
                     ▼
┌─────────────────────────────────────────────────────┐
│  21 Tool Functions (634 LOC)                         │
│  - getCustomerProfile, getSubscription, etc.         │
│  - getRenewalPipeline, getSegmentBreakdown, etc.     │
│  - draftEmail, scheduleCall, etc.                    │
└──────────────────┬──────────────────────────────────┘
                   ▼
┌─────────────────────────────────────────────────────┐
│  Supabase (Postgres)                                 │
│  - customers, subscriptions, usage, meetings         │
│  - Query-time stitching by org_nr                    │
└─────────────────────────────────────────────────────┘
        </pre>
      </div>

      <h2 class="section-title">Code Breakdown</h2>
      <ul class="layer-list">
        <li><strong>UI (cards + chat) — 2,484 lines (60%):</strong> Tailwind dark-mode chat interface, 6 card types, streaming messages</li>
        <li><strong>Data access (skills) — 634 lines (15%):</strong> Pure functions that query customer data</li>
        <li><strong>Tool definitions (Zod) — 290 lines (7%):</strong> Schema + descriptions for 21 tools</li>
        <li><strong>Mock data — 688 lines (17%):</strong> 18 companies with full cross-source data</li>
        <li><strong>System prompt — 54 lines (1%):</strong> Agent persona, glossary, behavior rules</li>
      </ul>

      <h2 class="section-title">Why Archived</h2>
      <div class="highlight-box" style="background: rgba(217,119,6,0.08);">
        <h3>The 60% Problem</h3>
        <p><strong>60% of code rebuilds what Claude.ai already has.</strong> Chat UI, streaming, message history, dark mode — all standard. The moat is data + tools (39%), not the interface. V3 eliminates this waste by using Claude as the UI.</p>
      </div>
    </div>

    <!-- V3: MCP Server (CURRENT) -->
    <div class="version-content active" data-version-content="v3">
      <div class="highlight-box">
        <h3>V3: MCP Server (Live with Mock Data)</h3>
        <p>The moat is data, not UI. Build 21 tools as an MCP server, plug into Claude.ai/Code/Cowork natively. Zero UI to maintain. Multi-surface by default.</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">UI Code</div>
          <div class="stat-value">0</div>
          <div class="stat-desc">lines (uses Claude natively)</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tools</div>
          <div class="stat-value">21</div>
          <div class="stat-desc">MCP protocol</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Coverage</div>
          <div class="stat-value">96%</div>
          <div class="stat-desc">48/50 questions</div>
        </div>
      </div>

      <h2 class="section-title">Architecture</h2>
      <div class="diagram-box">
        <pre>
┌─────────────────────────────────────────────────────┐
│  Interface (User Chooses)                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │Claude.ai │  │Claude Code│ │  Cowork  │ (future) │
│  │(Web Chat)│  │   (IDE)   │  │ (Teams)  │          │
│  └────┬─────┘  └────┬──────┘  └────┬─────┘          │
└───────┼─────────────┼──────────────┼────────────────┘
        └─────────────┴──────────────┘
                      ▼
        ┌─────────────────────────────┐
        │  MCP Protocol (STDIO)       │
        └──────────────┬──────────────┘
                       ▼
┌─────────────────────────────────────────────────────┐
│  MCP Server (TypeScript/Node.js)                     │
│  ┌────────────────────────────────────────────┐     │
│  │  21 Tools (11 data + 5 agg + 5 action)     │     │
│  │  - getCustomerProfile, getSubscription     │     │
│  │  - getRenewalPipeline, getSegmentBreakdown │     │
│  │  - draftEmail, scheduleCall, etc.          │     │
│  └──────────────────┬─────────────────────────┘     │
└────────────────────┼──────────────────────────────────┘
                     ▼
┌─────────────────────────────────────────────────────┐
│  Supabase (Postgres)                                 │
│  - 7 sources stitched by org_nr                      │
│  - Query-time joins (always fresh)                   │
└─────────────────────────────────────────────────────┘
        </pre>
      </div>

      <h2 class="section-title">Key Layers</h2>
      <ul class="layer-list">
        <li><strong>Interface:</strong> Claude.ai, Claude Code, or future Cowork. User chooses. MCP = native integration.</li>
        <li><strong>MCP Server:</strong> STDIO transport. 21 tools exposed via Model Context Protocol.</li>
        <li><strong>Tools:</strong> 11 data (raw facts), 5 aggregate (multi-source), 5 action (HITL).</li>
        <li><strong>Database:</strong> Supabase Postgres. Scheduled syncs from 7 sources. Query-time stitching.</li>
      </ul>

      <h2 class="section-title">Why This Works</h2>
      <div class="highlight-box" style="background: rgba(74,222,128,0.08);">
        <h3>Zero UI to Maintain</h3>
        <p><strong>Anthropic owns the interface. We own the data.</strong> Claude.ai already has chat, streaming, message history, dark mode. MCP plugs in natively — no rebuild needed. When Cowork launches, same tools work instantly. Multi-surface by default.</p>
      </div>
    </div>

    <!-- V4: Customer Intelligence OS -->
    <div class="version-content" data-version-content="v4">
      <div class="highlight-box">
        <h3>V4: Customer Intelligence OS (Future)</h3>
        <p>Best of all worlds — structured dashboards (V1) + AI copilot (V2) powered by MCP data layer (V3). 3-column layout with toggleable copilot panel.</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Layout</div>
          <div class="stat-value" style="font-size: 16px;">3-Col</div>
          <div class="stat-desc">Sidebar + Main + Copilot</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Screens</div>
          <div class="stat-value">7</div>
          <div class="stat-desc">Pulse, Search, Profile, etc.</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Data Layer</div>
          <div class="stat-value" style="font-size: 16px;">MCP</div>
          <div class="stat-desc">Reuses V3 tools</div>
        </div>
      </div>

      <h2 class="section-title">Architecture</h2>
      <div class="diagram-box">
        <pre>
┌─────────────────────────────────────────────────────┐
│  Browser (Next.js)                                   │
│  ┌──────┬──────────────────────────┬──────────┐    │
│  │ Side │  Main Content Area       │ Copilot  │    │
│  │ bar  │  ┌────────────────────┐  │ Panel    │    │
│  │      │  │ Pulse Dashboard    │  │ ┌──────┐ │    │
│  │ 7    │  │ - Health Heatmap   │  │ │Claude│ │    │
│  │ Nav  │  │ - KPI Cards        │  │ │ AI   │ │    │
│  │ Items│  │ - Renewal Pipeline │  │ │Assist│ │    │
│  │      │  │ - Alert Feed       │  │ └──────┘ │    │
│  │      │  └────────────────────┘  │ Suggest. │    │
│  └──────┴──────────────────────────┴──────────┘    │
└────────────────────┬──────────────────────────────────┘
                     ▼
┌─────────────────────────────────────────────────────┐
│  API Layer                                           │
│  ┌─────────────────┐  ┌─────────────────────┐       │
│  │ Dashboard APIs  │  │ Copilot API         │       │
│  │ (pre-computed)  │  │ (Claude + MCP)      │       │
│  └────────┬────────┘  └──────────┬──────────┘       │
└───────────┼────────────────────────┼────────────────┘
            │                        │
            ▼                        ▼
┌───────────────────┐  ┌─────────────────────────┐
│  Supabase         │  │  V3 MCP Server          │
│  (cached views)   │  │  (21 tools)             │
└───────────────────┘  └─────────────────────────┘
        </pre>
      </div>

      <h2 class="section-title">Key Layers</h2>
      <ul class="layer-list">
        <li><strong>Sidebar:</strong> 7 nav items (Pulse, Search, Profile, Segments, Renewals, Risks, Action Log).</li>
        <li><strong>Main:</strong> Structured visual dashboards. Heatmaps, KPI cards, timelines, feeds.</li>
        <li><strong>Copilot:</strong> Toggleable AI panel (Cmd+K). Uses V3 MCP tools for NL queries.</li>
        <li><strong>Data:</strong> Hybrid — pre-computed views for dashboards, MCP tools for copilot.</li>
      </ul>

      <h2 class="section-title">Why Later</h2>
      <div class="highlight-box" style="background: rgba(251,191,36,0.08);">
        <h3>Build V3 First</h3>
        <p><strong>V3 validates the data layer.</strong> Once MCP tools prove they answer 96% of questions, V4 adds visual polish. Dashboards show what you want to see often. Copilot answers what you ask occasionally. Best of both.</p>
      </div>
    </div>

  </div>

  <script>
    const versionBtns = document.querySelectorAll('.version-btn');
    const versionContents = document.querySelectorAll('.version-content');

    versionBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const version = btn.dataset.version;

        // Update button states
        versionBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Update content visibility
        versionContents.forEach(content => {
          content.classList.toggle('active', content.dataset.versionContent === version);
        });
      });
    });
  </script>

</body>
</html>
